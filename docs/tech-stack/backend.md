# バックエンド

## 技術選定

### Rails

バックエンドのメインフレームワーク。
golangやTypeScript系のフレームワークも考えたが、実装コストの低さからRailsに決定。

### アーキテクチャ

Model, Service, Controllerの3レイヤーに分割して実装する。
Rails汎用のMVCに従わない理由は、複数のAPIのロジック実装がControllerに入り、Controllerがファットになりそうであるため。
CAなどの考えを取り入れ、ServiceクラスをAPI毎に作成してロジックを分離することでこれを回避する。

### OpenAPI

スキーマ駆動開発のため、OpenAPIを用いてスキーマの生成等を行う。
ライブラリはデファクトスタンダードである Rswag × Rspec で行う。

### キャッシュ戦略

タイムラインが何度も表示されるため、フィード周りはキャッシュとして持ちクエリを何度も送らないようにしてパフォーマンスの向上を図る。
キャッシュはRedisを用いる。Memcachedもあるが、DBのレコードをキャッシュとして持ちたいためハッシュなどを扱えるRedisを用いる。
また非同期Jobの情報もRedisに格納出来るため、これを用いる。

### 非同期Job

以下に候補に示す。

* Solid queue / ActiveJob
  * Rails標準の非同期タスク
  * DBベースでタスクを管理
  * Rails8から
* Sidekiq
  * 安定
  * Redisベースでタスクを管理
* ECS
  * ジョブ処理用のコンテナを作成
  * 無料枠内で一応おさまる

今回はキャッシュとしてRedisを使うことが既に決まっているため、Sidekiqを採用。
ECSは実際に組んでみたら無料枠超える、がありそう
